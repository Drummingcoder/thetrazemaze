<!DOCTYPE html>
<html>
<head>
  <title>The Traze Maze</title>
  <link rel="icon" type="icon/x-image" href="logo.jpg">
  <link rel="stylesheet" type="text/css" href="mazestyle.css">
  <style>
    /* End screen color scheme to match maze */
    #end-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, rgba(35, 40, 55, 0.92) 0%, rgba(45, 50, 65, 0.92) 100%);
      color: #C0C0C0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Courier New', monospace;
      font-size: 18px;
      font-weight: bold;
      z-index: 2000;
      border: none;
      box-shadow: none;
      text-align: center;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    #end-screen h2 {
      color: #FF1744; /* Red to match end square */
      margin-bottom: 12px;
      font-size: 26px;
      font-weight: bold;
      text-shadow: 0 2px 8px rgba(183, 28, 28, 0.3);
    }

    #end-time-taken {
      color: #C0C0C0; /* Silver text */
      font-size: 20px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    #personal-best {
      color: #FF1744; /* Red accent for best time */
      font-size: 16px;
      margin-bottom: 8px;
      font-weight: bold;
    }

    #new-personal-best {
      color: #FF5252; /* Lighter red accent */
      font-size: 16px;
      margin-bottom: 8px;
      font-weight: bold;
    }

    #end-screen button {
      background: linear-gradient(135deg, #7B7F85 0%, #C0C0C0 100%);
      color: #232837;
      border: 2px solid #A0A4AA;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 16px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      margin: 8px 0;
      box-shadow: 0 2px 8px rgba(123, 127, 133, 0.15);
      cursor: pointer;
      transition: background 0.3s, border 0.3s;
    }

    #end-screen button:hover {
      background: linear-gradient(135deg, #FF1744 0%, #B71C1C 100%);
      color: #C0C0C0;
      border-color: #B71C1C;
    }
    body {
      text-align: center;
      background: linear-gradient(135deg, 
        rgba(25, 30, 45, 0.98) 0%, 
        rgba(35, 40, 55, 0.96) 50%, 
        rgba(45, 50, 65, 0.98) 100%);
      background-size: 100% 100%;
      background-attachment: fixed;
      position: relative;
      overflow-x: hidden;
      /* Removed expensive animation for better performance */
    }
    
    /* Simplified atmospheric background - much better performance */
    @keyframes subtleGlow {
      0% { opacity: 0.95; }
      50% { opacity: 1.0; }
      100% { opacity: 0.95; }
    }
    
    /* Optional: Add a very subtle animation only if needed */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 30%, rgba(70, 80, 120, 0.1) 0%, transparent 50%);
      animation: subtleGlow 8s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* COMMENTED OUT - Two large waving stickmen on sides of maze - optimized for performance */
    /*
    .waving-stickman {
      position: fixed;
      width: 96px;
      height: 96px;
      background-image: url('waving-stickman-spritesheet.png');
      background-size: 288px 96px;
      background-repeat: no-repeat;
      background-position: 0 0;
      pointer-events: none;
      z-index: -1;
      opacity: 0.9;
      image-rendering: pixelated;
      will-change: background-position;
    }
    
    .stickman-left { 
      top: 50%; 
      left: 5%; 
      transform: translateY(-50%);
      animation: waveFrames 2.0s steps(3) infinite; 
    }
    .stickman-right { 
      top: 50%; 
      right: 5%; 
      transform: translateY(-50%);
      animation: waveFrames 2.2s steps(3) infinite 0.5s;
    }
    
    @keyframes waveFrames {
      0% { background-position: 0 0; }
      33.33% { background-position: -96px 0; }
      66.66% { background-position: -192px 0; }
      100% { background-position: 0 0; }
    }
    */

    #timer {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #FFFFFF;
      padding: 12px 18px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 18px;
      font-weight: bold;
      z-index: 1000;
      border: 2px solid #E1BEE7;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    #dash-indicator {
      position: fixed;
      top: 80px; /* Below the timer with more space */
      right: 20px;
      background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
      color: #FFFFFF;
      padding: 8px 12px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      font-weight: bold;
      z-index: 1000;
      border: 2px solid #10B981; /* Green border when ready */
      box-shadow: 0 3px 12px rgba(16, 185, 129, 0.4);
      transition: all 0.3s ease;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    #dash-indicator.cooldown {
      background: linear-gradient(135deg, #FF6B6B 0%, #EE5A52 100%);
      border-color: #EF4444; /* Red border when on cooldown */
      box-shadow: 0 3px 12px rgba(239, 68, 68, 0.4);
      color: #FFFFFF;
    }

    #ground-pound-indicator {
      position: fixed;
      top: 130px; /* Moved up to replace jump indicator position */
      right: 20px;
      background: linear-gradient(135deg, #FF8A80 0%, #FF5722 100%);
      color: #FFFFFF;
      padding: 8px 12px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      font-weight: bold;
      z-index: 1000;
      border: 2px solid #DC2626; /* Red border for ground pound */
      box-shadow: 0 3px 12px rgba(220, 38, 38, 0.4);
      transition: all 0.3s ease;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    #ground-pound-indicator.cooldown {
      background: linear-gradient(135deg, #FFEAA7 0%, #F59E0B 100%);
      border-color: #F59E0B; /* Orange border when on cooldown */
      box-shadow: 0 3px 12px rgba(245, 158, 11, 0.4);
      color: #1F2937; /* Dark text for better contrast on yellow */
    }

    #ground-pound-indicator.active {
      background: linear-gradient(135deg, #FF1744 0%, #B91C1C 100%);
      border-color: #B91C1C; /* Dark red border when ground pounding */
      box-shadow: 0 3px 15px rgba(185, 28, 28, 0.6);
      color: #FFFFFF;
      animation: pulse-red 0.3s infinite alternate;
    }

    #ground-pound-indicator.disabled {
      background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%);
      border-color: #6B7280; /* Gray border when disabled */
      box-shadow: 0 3px 12px rgba(107, 114, 128, 0.3);
      color: #D1D5DB; /* Light gray text */
    }

    #jump-charge-indicator {
      position: fixed;
      background: linear-gradient(135deg, #FFEAA7 0%, #F59E0B 50%, #FF8C00 100%);
      color: #000000;
      padding: 6px 10px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      z-index: 999; /* Behind player but above maze */
      border: 2px solid #F59E0B;
      box-shadow: 0 3px 10px rgba(245, 158, 11, 0.5);
      transition: all 0.1s ease;
      pointer-events: none; /* Don't interfere with game interaction */
      opacity: 0; /* Hidden by default */
      transform: translateX(-50%) translateY(-50%); /* Center on position */
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
    }

    #jump-charge-indicator.visible {
      opacity: 1;
      animation: chargePulse 0.5s ease-in-out infinite alternate;
    }

    @keyframes chargePulse {
      0% { 
        box-shadow: 0 3px 10px rgba(245, 158, 11, 0.5);
        transform: translateX(-50%) translateY(-50%) scale(1);
      }
      100% { 
        box-shadow: 0 5px 15px rgba(245, 158, 11, 0.8);
        transform: translateX(-50%) translateY(-50%) scale(1.05);
      }
    }

    @keyframes pulse-red {
      from { transform: scale(1); opacity: 0.8; }
      to { transform: scale(1.05); opacity: 1; }
    }

    #controls-hint {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(30, 58, 95, 0.95);
      color: #FFFFFF;
      padding: 15px 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      font-weight: bold;
      z-index: 2000;
      border: 2px solid #F59E0B; /* Orange border to match theme */
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
      text-align: center;
      max-width: 80%;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    #controls-hint.hidden {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.9);
      pointer-events: none;
    }

    #debug-console {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 400px;
      max-height: 300px;
      background-color: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      border: 2px solid #333;
      border-radius: 5px;
      padding: 10px;
      overflow-y: auto;
      z-index: 3000;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    #debug-console .debug-entry {
      margin-bottom: 2px;
      border-bottom: 1px solid #333;
      padding-bottom: 2px;
    }

    #debug-console .debug-timestamp {
      color: #888;
      font-size: 10px;
    }

    #debug-console .debug-error {
      color: #ff4444;
    }

    #debug-console .debug-warn {
      color: #ffaa00;
    }

    #debug-console .debug-info {
      color: #4488ff;
    }

    #maze-container {
      position: relative;
      overflow: hidden;
      background: transparent; /* Removed white background */
      border: none; /* Removed border that created white square effect */
      border-radius: 0;
      box-shadow: none; /* Removed shadow */
      /* Performance optimizations */
      will-change: transform;
      transform: translateZ(0); /* Force GPU acceleration */
      backface-visibility: hidden;
      /* Dynamic sizing will be applied via JavaScript */
    }

    #maze-canvas {
      display: block;
      image-rendering: pixelated; /* Keep crisp edges */
      /* Performance optimizations for canvas */
      will-change: transform;
      transform: translateZ(0); /* Force GPU acceleration */
      backface-visibility: hidden;
      /* Dynamic sizing and positioning will be applied via JavaScript */
    }
    
    /* Preload critical images */
    body::after {
      content: '';
      position: absolute;
      left: -9999px;
      background-image: url('stickman-running-spritesheet.png'), url('waving-stickman-spritesheet.png');
    }

    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000000;
      z-index: 5000;
      opacity: 1;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    /* Start Screen Styles */
    #start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, rgba(35, 40, 55, 0.98) 0%, rgba(45, 50, 65, 0.98) 100%);
      color: #C0C0C0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Courier New', monospace;
      z-index: 3000;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    #start-screen.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }

    .start-content {
      text-align: center;
      max-width: 600px;
      padding: 40px;
    }

    .start-content h1 {
      font-size: 48px;
      color: #2196F3;
      margin-bottom: 40px;
      text-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
      font-weight: bold;
    }

    .start-buttons {
      display: flex;
      flex-direction: row;
      gap: 30px;
      align-items: center;
      justify-content: center;
    }

    .start-buttons button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #7B7F85 100%);
      color: #FFFFFF;
      border: 3px solid #E1BEE7;
      border-radius: 20px;
      padding: 18px 45px;
      font-size: 20px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.4s ease;
      min-width: 180px;
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .start-buttons button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.5s;
      opacity: 0;
    }

    .start-buttons button:hover {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 50%, #0D47A1 100%);
      color: #FFFFFF;
      border-color: #1976D2;
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 12px 40px rgba(33, 150, 243, 0.6);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .start-buttons button:hover::before {
      opacity: 1;
      animation: shimmer 0.6s ease-in-out;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .start-buttons button:active {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 8px 25px rgba(33, 150, 243, 0.5);
    }

    /* Settings gear icon in top right */
    #settings-gear {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #7B7F85 0%, #C0C0C0 100%);
      border: 2px solid #A0A4AA;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #232837;
      transition: all 0.3s ease;
      z-index: 3001;
      box-shadow: 0 2px 8px rgba(123, 127, 133, 0.2);
    }

    #settings-gear:hover {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: #C0C0C0;
      border-color: #1976D2;
      transform: rotate(180deg);
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }

    /* About button in bottom right */
    #about-corner {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #7B7F85 0%, #C0C0C0 100%);
      color: #232837;
      border: 2px solid #A0A4AA;
      border-radius: 25px;
      padding: 10px 20px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 3001;
      box-shadow: 0 2px 8px rgba(123, 127, 133, 0.2);
    }

    #about-corner:hover {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: #C0C0C0;
      border-color: #1976D2;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }

    /* Level Select Screen Styles */
    #level-select-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, rgba(35, 40, 55, 0.98) 0%, rgba(45, 50, 65, 0.98) 100%);
      color: #C0C0C0;
      display: none;
      justify-content: center;
      align-items: center;
      font-family: 'Courier New', monospace;
      z-index: 3000;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    #level-select-screen.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }

    .level-select-content {
      text-align: center;
      max-width: 1000px;
      padding: 30px;
    }

    .level-select-content h1 {
      font-size: 42px;
      color: #2196F3;
      margin-bottom: 20px;
      text-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
      font-weight: bold;
    }

    .level-select-content p {
      font-size: 18px;
      color: #C0C0C0;
      margin-bottom: 40px;
      opacity: 0.8;
    }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }

    .level-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #7B7F85 100%);
      color: #FFFFFF;
      border: 3px solid #E1BEE7;
      border-radius: 15px;
      padding: 15px 15px;
      cursor: pointer;
      transition: all 0.4s ease;
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      min-height: 120px;
    }

    .level-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.5s;
      opacity: 0;
    }

    .level-card:hover {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 50%, #0D47A1 100%);
      border-color: #1976D2;
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 15px 45px rgba(33, 150, 243, 0.6);
    }

    .level-card:hover::before {
      opacity: 1;
      animation: shimmer 0.6s ease-in-out;
    }

    .level-card.locked {
      background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);
      border-color: #9CA3AF;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .level-card.locked:hover {
      background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);
      transform: none;
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
    }

    .level-number {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .level-name {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .level-difficulty {
      font-size: 14px;
      opacity: 0.8;
    }

    .back-to-menu {
      background: linear-gradient(135deg, #7B7F85 0%, #C0C0C0 100%);
      color: #232837;
      border: 2px solid #A0A4AA;
      border-radius: 25px;
      padding: 12px 30px;
      font-size: 16px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(123, 127, 133, 0.2);
    }

    .back-to-menu:hover {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: #C0C0C0;
      border-color: #1976D2;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }
  </style>
</head>
<body>
  <!-- Black loading screen overlay -->
  <div id="loading-overlay"></div>
  <!-- COMMENTED OUT - Two large waving stickmen on either side of the maze -->
  <!-- <div class="waving-stickman stickman-left"></div> -->
  <!-- <div class="waving-stickman stickman-right"></div> -->
  
  <!-- Start Screen -->
  <div id="start-screen">
    <!-- Settings gear icon in top right -->
    <div id="settings-gear" title="Settings">‚öôÔ∏è</div>
    
    <!-- About button in bottom right -->
    <div id="about-corner" title="About">About</div>
    
    <div class="start-content">
      <h1>The Traze Maze</h1>
      <div class="start-buttons">
        <button id="start-game-btn">üöÄ Start Game</button>
        <button id="upgrades-btn">‚≠ê Upgrades</button>
      </div>
    </div>
  </div>

  <!-- Level Select Screen -->
  <div id="level-select-screen">
    <div class="level-select-content">
      <h1>Select Level</h1>
      <p>Choose your challenge and test your maze-solving skills!</p>
      
      <div class="level-grid">
        <div class="level-card" id="level-1-card" data-level="1">
          <div class="level-number">Level 1</div>
          <div class="level-name">üåü The Beginning</div>
        </div>
        
        <div class="level-card" id="level-2-card" data-level="2">
          <div class="level-number">Level 2</div>
          <div class="level-name">üî• Heat Wave</div>
          <div class="level-difficulty">Twice the Size!</div>
        </div>
        
        <div class="level-card locked" id="level-3-card" data-level="3">
          <div class="level-number">Level 3</div>
          <div class="level-name">‚ùÑÔ∏è Ice Palace</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-4-card" data-level="4">
          <div class="level-number">Level 4</div>
          <div class="level-name">‚ö° Lightning Storm</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-5-card" data-level="5">
          <div class="level-number">Level 5</div>
          <div class="level-name">üåä Ocean Depths</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-6-card" data-level="6">
          <div class="level-number">Level 6</div>
          <div class="level-name">üåã Volcano Core</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-7-card" data-level="7">
          <div class="level-number">Level 7</div>
          <div class="level-name">üåå Space Station</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-8-card" data-level="8">
          <div class="level-number">Level 8</div>
          <div class="level-name">üè∞ Ancient Castle</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-9-card" data-level="9">
          <div class="level-number">Level 9</div>
          <div class="level-name">üé≠ Mirror Maze</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
        
        <div class="level-card locked" id="level-10-card" data-level="10">
          <div class="level-number">Level 10</div>
          <div class="level-name">üëë Final Challenge</div>
          <div class="level-difficulty">Coming Soon</div>
        </div>
      </div>
      
      <button class="back-to-menu" id="back-to-menu-btn">‚Üê Back to Menu</button>
    </div>
  </div>

  <div id="timer">00:00.000</div>
  <div id="dash-indicator">Dash Ready</div>
  <div id="ground-pound-indicator">Ground Pound Ready</div>
  <div id="controls-hint">Arrow Keys/WASD: Move | Shift/Space: Dash | Hold Up/W: Charge Jump | Down/S (in air): Ground Pound</div>
  <!--<div id="debug-console"></div>-->
  <div id="maze-container">
    <canvas id="maze-canvas"></canvas>
    <canvas id="player-canvas"></canvas>
  </div>

  <div id="end-screen" class="hidden">
  <button id="back-button">Back</button>
  <h2 id="end-content">Congratulations!</h2>

  <div id="end-time-taken"></div>
  <div id="personal-best">
    Personal Best: <span id="best-time"></span>
  </div>
  <div id="new-personal-best" style = "display:block;">Personal New Best!</div>

    <button id="restart-button">Restart Maze</button>
  </div>
  
  <!-- Modular JavaScript Files - Load in dependency order -->
  <script src="./js/debug-console.js"></script>
  <script src="./js/url-parameters.js"></script>
  <script src="./js/audio-manager.js"></script>
  <script src="./js/game-timer.js"></script>
  <script src="./js/personal-best-manager.js"></script>
  <script src="./js/maze-generator.js"></script>
  <script src="./js/maze-renderer.js"></script>
  <script src="./js/camera-system.js"></script>
  <script src="./js/player-animation.js"></script>
  <script src="./js/canvas-renderer.js"></script>
  <script src="./js/player-controller.js"></script>
  <script src="./js/event-handler.js"></script>
  <script src="./js/game-initializer.js"></script>
  <script src="./js/game-actions.js"></script>
  <script src="./js/main-library.js"></script>

  <script>
    // =================================================================
    // START SCREEN MANAGEMENT
    // =================================================================
    
    // Start screen state
    let isGameStarted = false;
    
    // Initialize start screen
    function initializeStartScreen() {
      const startScreen = document.getElementById('start-screen');
      const startGameBtn = document.getElementById('start-game-btn');
      const settingsGear = document.getElementById('settings-gear');
      const upgradesBtn = document.getElementById('upgrades-btn');
      const aboutCorner = document.getElementById('about-corner');
      
      // Hide game elements initially
      const gameElements = [
        document.getElementById('timer'),
        document.getElementById('dash-indicator'),
        document.getElementById('ground-pound-indicator'),
        document.getElementById('controls-hint'),
        document.getElementById('maze-container')
      ];
      
      // Also hide the controls hint specifically
      const controlsHint = document.getElementById('controls-hint');
      if (controlsHint) {
        controlsHint.classList.add('hidden');
      }
      
      // Hide heart overlay if it exists
      if (typeof setHeartOverlayVisible === 'function') {
        setHeartOverlayVisible(false);
      } else {
        // Fallback: hide heart overlay directly
        const heartOverlay = document.getElementById('heart-overlay');
        if (heartOverlay) {
          heartOverlay.style.display = 'none';
        }
      }
      
      gameElements.forEach(element => {
        if (element) {
          element.style.display = 'none';
        }
      });
      
      // Start game button handler - now goes to level select
      if (startGameBtn) {
        startGameBtn.addEventListener('click', function() {
          console.log('Start Game clicked - showing level select');
          showLevelSelect();
        });
      }
      // Settings gear icon handler (placeholder for now)
      if (settingsGear) {
        settingsGear.addEventListener('click', function() {
          console.log('Settings gear clicked');
          alert('Settings feature coming soon!');
        });
      }
      
      // Upgrades button handler (placeholder for now)
      if (upgradesBtn) {
        upgradesBtn.addEventListener('click', function() {
          console.log('Upgrades clicked');
          alert('Upgrades feature coming soon! üöÄ\n\nUpgrade your player with:\n‚Ä¢ Faster movement speed\n‚Ä¢ Longer dash distance\n‚Ä¢ Reduced cooldowns\n‚Ä¢ Special abilities');
        });
      }
      
      // About corner button handler (placeholder for now)
      if (aboutCorner) {
        aboutCorner.addEventListener('click', function() {
          console.log('About corner clicked');
          alert('The Traze Maze v2.0\n\nNavigate through the maze as fast as you can!\n\nControls:\n‚Ä¢ Arrow Keys/WASD: Move\n‚Ä¢ Shift/Space: Dash\n‚Ä¢ Hold Up/W: Charge Jump\n‚Ä¢ Down/S (in air): Ground Pound\n\nCreated by Drummingcoder');
        });
      }
    }
    
    // Show level select screen
    function showLevelSelect() {
      console.log('Showing level select screen...');
      
      // Hide start screen
      const startScreen = document.getElementById('start-screen');
      if (startScreen) {
        startScreen.classList.add('hidden');
        setTimeout(() => {
          startScreen.style.display = 'none';
        }, 500);
      }
      
      // Show level select screen
      const levelSelectScreen = document.getElementById('level-select-screen');
      if (levelSelectScreen) {
        setTimeout(() => {
          levelSelectScreen.style.display = 'flex';
          setTimeout(() => {
            levelSelectScreen.classList.remove('hidden');
          }, 50);
        }, 300);
      }
      
      // Setup level select event listeners
      setupLevelSelectListeners();
    }
    
    // Setup level select event listeners
    function setupLevelSelectListeners() {
      // Level 1 card (unlocked)
      const level1Card = document.getElementById('level-1-card');
      if (level1Card) {
        level1Card.addEventListener('click', function() {
          console.log('Level 1 selected');
          startGameWithLevel(1);
        });
      }
      
      // Level 2 card (now unlocked)
      const level2Card = document.getElementById('level-2-card');
      if (level2Card) {
        level2Card.addEventListener('click', function() {
          console.log('Level 2 selected');
          startGameWithLevel(2);
        });
      }
      
      // Locked level cards (levels 3-10, show coming soon message)
      const lockedCards = document.querySelectorAll('.level-card.locked');
      lockedCards.forEach(card => {
        card.addEventListener('click', function() {
          const levelNum = card.getAttribute('data-level');
          console.log(`Locked level ${levelNum} clicked`);
          alert(`Level ${levelNum} is coming soon! üöß\n\nStay tuned for more challenging mazes!`);
        });
      });
      
      // Back to menu button
      const backToMenuBtn = document.getElementById('back-to-menu-btn');
      if (backToMenuBtn) {
        backToMenuBtn.addEventListener('click', function() {
          console.log('Back to menu clicked');
          showStartScreen();
        });
      }
    }
    
    // Show start screen (back from level select)
    function showStartScreen() {
      console.log('Returning to start screen...');
      
      // Cleanup game systems to stop timers and movement
      if (window.GameInitializer && window.GameInitializer.cleanupGameSystems) {
        window.GameInitializer.cleanupGameSystems();
      }
      
      // Hide end screen if it's showing
      const endScreen = document.getElementById('end-screen');
      if (endScreen && !endScreen.classList.contains('hidden')) {
        endScreen.classList.add('hidden');
      }
      
      // Hide game elements
      const gameElements = [
        document.getElementById('timer'),
        document.getElementById('dash-indicator'),
        document.getElementById('ground-pound-indicator'),
        document.getElementById('controls-hint'),
        document.getElementById('maze-container')
      ];
      
      gameElements.forEach(element => {
        if (element) {
          element.style.display = 'none';
        }
      });
      
      // Reset game started flag
      isGameStarted = false;
      
      // Hide level select screen
      const levelSelectScreen = document.getElementById('level-select-screen');
      if (levelSelectScreen) {
        levelSelectScreen.classList.add('hidden');
        setTimeout(() => {
          levelSelectScreen.style.display = 'none';
        }, 500);
      }
      
      // Show start screen
      const startScreen = document.getElementById('start-screen');
      if (startScreen) {
        setTimeout(() => {
          startScreen.style.display = 'flex';
          setTimeout(() => {
            startScreen.classList.remove('hidden');
          }, 50);
        }, 300);
      }
    }
    
    // Make showStartScreen globally available
    window.showStartScreen = showStartScreen;
    
    // Start game with specific level
    function startGameWithLevel(levelNumber) {
      console.log(`Starting game with level ${levelNumber}...`);
      
      // Set the selected level globally
      window.selectedLevel = levelNumber;
      
      // Re-initialize maze data for the selected level
      const mazeData = window.MazeGenerator.getMazeData(levelNumber);
      console.log('Loading maze data for level', levelNumber, ':', mazeData);
      
      // Update global maze variables
      window.mazeStructure = mazeData.mazeStructure;
      window.mazeSize = mazeData.mazeSize;
      window.startRow = mazeData.startRow;
      window.startCol = mazeData.startCol;
      window.endRow = mazeData.endRow;
      window.endCol = mazeData.endCol;
      
      // Recalculate cell size for the new maze size
      const availableWidth = window.innerWidth;
      const availableHeight = window.innerHeight;
      const maxCellSizeWidth = Math.floor(availableWidth / window.mazeSize);
      const maxCellSizeHeight = Math.floor(availableHeight / window.mazeSize);
      window.cellSize = Math.min(maxCellSizeWidth, maxCellSizeHeight);
      
      // Ensure minimum cell size
      if (window.cellSize < 3) {
        window.cellSize = 3;
      }
      
      // Update canvas sizes
      const mazeWidthPx = window.mazeSize * window.cellSize;
      const mazeHeightPx = window.mazeSize * window.cellSize;
      
      if (window.canvas) {
        window.canvas.width = mazeWidthPx;
        window.canvas.height = mazeHeightPx;
      }
      
      if (window.playerCanvas) {
        window.playerCanvas.width = mazeWidthPx;
        window.playerCanvas.height = mazeHeightPx;
      }
      
      // Start the actual game
      startGame(levelNumber);
    }
    
    // Start the actual game (modified to accept level parameter)
    function startGame(levelNumber = 1) {
      console.log(`Starting game... Level: ${levelNumber}`);
      isGameStarted = true;
      
      // Show loading overlay during game initialization
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) {
        loadingOverlay.style.display = 'block';
        loadingOverlay.style.opacity = '1';
      }
      
      // Hide level select screen (or start screen if coming directly)
      const levelSelectScreen = document.getElementById('level-select-screen');
      const startScreen = document.getElementById('start-screen');
      
      if (levelSelectScreen && levelSelectScreen.style.display === 'flex') {
        levelSelectScreen.classList.add('hidden');
        setTimeout(() => {
          levelSelectScreen.style.display = 'none';
        }, 500);
      } else if (startScreen && startScreen.style.display !== 'none') {
        startScreen.classList.add('hidden');
        setTimeout(() => {
          startScreen.style.display = 'none';
        }, 500);
      }
      
      // Show game elements
      const gameElements = [
        document.getElementById('timer'),
        document.getElementById('dash-indicator'),
        document.getElementById('ground-pound-indicator'),
        document.getElementById('controls-hint'),
        document.getElementById('maze-container')
      ];
      
      gameElements.forEach(element => {
        if (element) {
          element.style.display = 'block';
        }
      });
      
      // Also remove the hidden class from controls hint
      const controlsHint = document.getElementById('controls-hint');
      if (controlsHint) {
        controlsHint.classList.remove('hidden');
      }
      
      // Show heart overlay when game starts
      if (typeof setHeartOverlayVisible === 'function') {
        setHeartOverlayVisible(true);
      } else {
        // Fallback: show heart overlay directly
        const heartOverlay = document.getElementById('heart-overlay');
        if (heartOverlay) {
          heartOverlay.style.display = 'block';
        }
      }
      
      // Initialize the actual game
      setTimeout(() => {
        initializeGame();
        
        // Hide loading overlay after game is initialized
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) {
          setTimeout(() => {
            loadingOverlay.style.opacity = '0';
            setTimeout(() => {
              loadingOverlay.style.display = 'none';
            }, 400);
          }, 500); // Give the game time to fully initialize
        }
      }, 100);
    }

    // Show black loading overlay and fade out after 0.75s
    window.addEventListener('DOMContentLoaded', function() {
      var loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) {
        setTimeout(function() {
          loadingOverlay.style.opacity = '0';
          setTimeout(function() {
            loadingOverlay.style.display = 'none';
            // Initialize start screen after loading overlay disappears
            initializeStartScreen();
          }, 400);
        }, 750);
      }
    });
    // =================================================================
    // MAIN GAME INITIALIZATION AND COORDINATION
    // =================================================================
    // This script coordinates the various JavaScript modules and handles
    // game-specific setup. Most game logic has been moved to modules:
    // - Camera functions ‚Üí js/camera-system.js
    // - Rendering functions ‚Üí js/canvas-renderer.js  
    // - Player movement ‚Üí js/player-controller.js
    // - Game initialization ‚Üí js/game-initializer.js
    // =================================================================
    
    // FORCE CLEAR all browser storage to prevent any data persistence between sessions
    try {
      sessionStorage.clear();
      // Don't clear localStorage as it contains best times
    } catch (e) {
      // Silently handle storage errors
    }
    
    // Audio loading moved to AudioManager module

    // Preload assets immediately when script loads
    window.addEventListener('DOMContentLoaded', function() {
      // Only preload images immediately - audio will be loaded later
      const preloadImages = ['stickman-running-spritesheet.png', 'waving-stickman-spritesheet.png'];
      preloadImages.forEach(src => {
        const img = new Image();
        img.src = src;
        img.style.display = 'none';
        document.body.appendChild(img);
      });
    });
 
  // Initialize URL parameters using module
  if (window.URLParameters) {
    window.URLParameters.init();
  } else {
    console.error('URLParameters module not loaded');
    // Fallback values
    window.type = null;
    window.multiple = null;
    window.difficulty = 'medium';
    window.mode = 'hard';
    window.easy = false;
  }
  
  // Get maze data from MazeGenerator module
  console.log('MazeGenerator available:', !!window.MazeGenerator);
  if (window.MazeGenerator) {
    console.log('MazeGenerator.getMazeData available:', !!window.MazeGenerator.getMazeData);
  }
  
  // Get the selected level (default to 1 if not set)
  const selectedLevel = window.selectedLevel || 1;
  const mazeData = MazeGenerator.getMazeData(selectedLevel);
  console.log('Maze data for level', selectedLevel, ':', mazeData);
  const predefinedMaze = mazeData.mazeStructure;
  
  // Set maze size based on predefined maze
  mazeSize = mazeData.mazeSize;
  console.log('Maze size:', mazeSize);
  
  // Calculate the maximum possible cell size to fill the screen
  const availableWidth = window.innerWidth;
  const availableHeight = window.innerHeight;
  
  // Calculate cell size based on screen dimensions and maze size
  const maxCellSizeWidth = Math.floor(availableWidth / mazeSize);
  const maxCellSizeHeight = Math.floor(availableHeight / mazeSize);
  
  // Use the smaller of the two to ensure the maze fits in both dimensions
  cellSize = Math.min(maxCellSizeWidth, maxCellSizeHeight);
  
  // Ensure minimum cell size for playability (but don't limit maximum)
  if (cellSize < 3) {
    cellSize = 3; // Minimum viable cell size
  }
  
  // Calculate actual maze dimensions in pixels
  const mazeWidthPx = mazeSize * cellSize;
  const mazeHeightPx = mazeSize * cellSize;
  
  // Set easy flag based on mode
  var easy = (mode === 'easy'); // Make global for library.js
  
  // Apply dynamic styling
  const mazeContainer = document.getElementById("maze-container");
  const canvas = document.getElementById("maze-canvas");
  const ctx = canvas.getContext("2d");
  const playerCanvas = document.getElementById("player-canvas");
  const playerCtx = playerCanvas.getContext("2d");
  
  // Set canvas sizes to the actual maze size
  canvas.width = mazeWidthPx;
  canvas.height = mazeHeightPx;
  playerCanvas.width = mazeWidthPx;
  playerCanvas.height = mazeHeightPx;
  
  // Configure maze canvas for crisp geometric rendering
  ctx.imageSmoothingEnabled = false; // Pixelated for crisp maze edges
  
  // Configure player canvas for smooth sprite rendering
  playerCtx.imageSmoothingEnabled = true;
  playerCtx.imageSmoothingQuality = 'high';
  if (playerCtx.webkitImageSmoothingEnabled !== undefined) playerCtx.webkitImageSmoothingEnabled = true;
  if (playerCtx.mozImageSmoothingEnabled !== undefined) playerCtx.mozImageSmoothingEnabled = true;
  if (playerCtx.msImageSmoothingEnabled !== undefined) playerCtx.msImageSmoothingEnabled = true;
  if (playerCtx.oImageSmoothingEnabled !== undefined) playerCtx.oImageSmoothingEnabled = true;
  
  // Set canvas size to the actual maze size
  canvas.width = mazeWidthPx;
  canvas.height = mazeHeightPx;
  
  // Make the container fill the screen and center the maze
  const style = document.createElement('style');
  style.textContent = `
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: relative;
      min-height: 100vh;
      min-width: 100vw;
    }
    #maze-container {
      width: ${mazeWidthPx}px;
      height: ${mazeHeightPx}px;
      position: absolute;
      top: 0;
      left: 0;
      overflow: visible;
    }
    #maze-canvas {
      display: block;
      image-rendering: pixelated; /* Crisp edges for maze geometry */
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1; /* Behind player */
    }
    #player-canvas {
      display: block;
      image-rendering: auto; /* Smooth rendering for player sprite */
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 3; /* Well above maze */
      pointer-events: none; /* Allow clicks to pass through to maze */
    }
  `;
  document.head.appendChild(style);

    var maze = document.getElementById("maze-container"); // Make global for library.js
    const timerElement = document.getElementById("timer");
    const endScreen = document.getElementById("end-screen");
    const restartButton = document.getElementById("restart-button");
    const backButton = document.getElementById("back-button");
    const endText = document.getElementById("end-content");
    const endContent = document.getElementById("end-time-taken");
    const personalbest = document.getElementById("personal-best");
    const newpersonalbest = document.getElementById("new-personal-best");

    // Make all variables global for module access
    window.maze = maze;
    window.timerElement = timerElement;
    window.endScreen = endScreen;
    window.restartButton = restartButton;
    window.backButton = backButton;
    window.endContent = endContent;
    window.endText = endText;
    window.personalbest = personalbest;
    window.newpersonalbest = newpersonalbest;
    window.mazeContainer = mazeContainer;
    window.canvas = canvas;
    window.ctx = ctx;
    window.playerCanvas = playerCanvas;
    window.playerCtx = playerCtx;

    var mazeStructure, startRow, startCol, endRow, endCol; // Make global for library.js
    let time = 0;
    let interval = false, startTime, startMaze;
    let first = 0;
    var mazecount = 0; // Make global for library.js
    
    // Canvas rendering system - smooth pixel-based movement system
    // FORCE RESET to 0 to prevent any persistence across reloads
    let playerX = 0, playerY = 0; // Player position in pixels - EXPLICITLY RESET TO 0
    
    // Make all maze and player variables global for module access
    window.mazeStructure = mazeStructure;
    window.startRow = startRow;
    window.startCol = startCol;
    window.endRow = endRow;
    window.endCol = endCol;
    window.mazeSize = mazeSize;
    window.cellSize = cellSize;
    window.playerX = playerX;
    window.playerY = playerY;
    window.time = time;
    window.interval = interval;
    window.startTime = startTime;
    window.first = first;
    window.mazecount = mazecount;
    window.type = type;
    window.easy = easy;
    
    // Smooth movement system variables (keep some references for compatibility)
    let playerIsMoving = false;
    let movementSpeed = 6; // Increased from 3 to 6 pixels per frame for faster movement
    let smoothMovementKeys = {};
    let animationFrameId = null;
    
    // Bridge functions to connect modules with remaining inline code
    function updateCameraAndRender() {
      if (window.CameraSystem && window.CameraSystem.cameraEnabled) {
        window.CameraSystem.updateCamera();
      }
      if (window.CanvasRenderer) {
        window.CanvasRenderer.renderFrame();
      }
    }
    
    function cleanupGameSystems() {
      if (window.GameInitializer) {
        window.GameInitializer.cleanupGameSystems();
      }
    }
    
    // Collision detection and end checking moved to PlayerController module
    
    // Smooth movement animation loop moved to PlayerController module
    
    // Cleanup functions moved to GameInitializer module
    
    // Camera system moved to CameraSystem module
    let cameraX = 0;
    let cameraY = 0;
    let currentZoom = 1.0;
    let cameraEnabled = false;
    
    // Canvas rendering system moved to CanvasRenderer module
    let renderPending = false;
    let lastRenderTime = 0;
    const RENDER_THROTTLE = 16; // 60 FPS max for smoother movement
    let renderQueued = false;
    
    // drawMaze and drawPlayer functions moved to CanvasRenderer module

    // renderFrame and related functions moved to CanvasRenderer module
    
    // Camera functions moved to CameraSystem module
    let cameraUpdatePending = false;

    // Setup predefined maze
    mazeStructure = predefinedMaze;
    
    // Set start and end positions for the predefined maze
    startRow = 2;  // In the expanded wide path area (top-left)
    startCol = 2;
    endRow = 46;   // Bottom right corner (last row - 1)
    endCol = 46;   // Bottom right corner (last column - 1)
    
    // Update global variables after assignment
    window.mazeStructure = mazeStructure;
    window.startRow = startRow;
    window.startCol = startCol;
    window.endRow = endRow;
    window.endCol = endCol;
    window.mazeSize = mazeSize;
    window.cellSize = cellSize;
    
    // CRITICAL: Prevent any changes to start position
    Object.defineProperty(window, 'startRow', {
      value: 2,
      writable: false,
      configurable: false
    });
    Object.defineProperty(window, 'startCol', {
      value: 2,
      writable: false,
      configurable: false
    });
    
    // Initialize player position using PlayerController
    if (window.PlayerController && window.PlayerController.initializePlayerPosition) {
      window.PlayerController.initializePlayerPosition();
    } else {
      // Fallback position initialization
      window.playerX = startCol * cellSize;
      window.playerY = startRow * cellSize;
    }
    
    // Create virtual player using PlayerController
    if (window.PlayerController && window.PlayerController.createVirtualPlayer) {
      window.PlayerController.createVirtualPlayer();
    } else {
      console.warn('PlayerController not available for virtual player creation');
    }
    
    // Initialize the canvas rendering system
    function initializeGame() {
      if (window.GameInitializer) {
        window.GameInitializer.initializeGame();
        
        // Ensure virtual player is created
        if (window.GameInitializer.createVirtualPlayer) {
          const virtualPlayer = window.GameInitializer.createVirtualPlayer();
          if (virtualPlayer) {
            window.player = virtualPlayer;
          }
        }
      } else {
        // Fallback initialization if module not loaded
        console.warn('GameInitializer module not loaded, using fallback');
        if (window.CameraSystem) {
          window.CameraSystem.resetCamera();
        }
        if (window.CanvasRenderer) {
          window.CanvasRenderer.renderFrame();
        }
      }
      
      // Start the smooth movement system
      if (window.PlayerController && window.PlayerController.startSmoothMovement) {
        window.PlayerController.startSmoothMovement();
      }
      
      // Initialize performance monitoring
      if (window.CanvasRenderer && window.CanvasRenderer.monitorPerformance) {
        window.CanvasRenderer.monitorPerformance();
      }
      
      // Prepare animation system
      if (window.CanvasRenderer && window.CanvasRenderer.prepareAnimationSystem) {
        window.CanvasRenderer.prepareAnimationSystem();
      }
    }
    
    // Force complete reset on page load but don't start game yet
    window.addEventListener('load', function() {
      // Only initialize if game has been started
      if (isGameStarted) {
        if (window.CameraSystem) {
          window.CameraSystem.resetCamera();
        }
        initializeGame();
        
        // Start audio loading after page is fully loaded and maze is initialized
        setTimeout(() => {
          console.log('Starting audio preload via AudioManager...');
          if (window.AudioManager) {
            console.log('AudioManager available:', !!window.AudioManager);
            console.log('AudioManager.isAudioPreloaded():', window.AudioManager.isAudioPreloaded());
            console.log('AudioManager.isAudioLoading():', window.AudioManager.isAudioLoading());
            
            if (!window.AudioManager.isAudioPreloaded() && !window.AudioManager.isAudioLoading()) {
              console.log('Starting audio preload via AudioManager...');
              window.AudioManager.preloadAudioAsync();
            } else {
              console.log('Audio already preloaded or loading - skipping preload');
            }
          } else {
            console.warn('AudioManager not available - audio preload skipped');
          }
        }, 200); // Ensure maze has time to fully initialize
      }
    });
    
    // Add missing resize handler
    window.addEventListener('resize', function() {
      if (window.GameInitializer && window.GameInitializer.resizeMaze) {
        window.GameInitializer.resizeMaze();
      }
    });
    
    // No need to wait for sprite loading - initialize only when game starts
    // initializeGame(); // Commented out - now handled by start screen

    // Force an immediate render to ensure maze displays - only when game starts
    /*
    setTimeout(() => {
      console.log('Forcing initial maze render...');
      console.log('Maze structure exists:', !!window.mazeStructure);
      console.log('Canvas exists:', !!window.canvas);
      console.log('Context exists:', !!window.ctx);
      console.log('CanvasRenderer exists:', !!window.CanvasRenderer);
      console.log('Maze size:', window.mazeSize);
      console.log('Cell size:', window.cellSize);
      console.log('Player position:', window.playerX, window.playerY);
      
      if (window.CanvasRenderer) {
        window.CanvasRenderer.renderFrame();
      }
    }, 100);
    */

    // Auto-hide controls hint after 5 seconds
    setTimeout(() => {
      const controlsHint = document.getElementById('controls-hint');
      if (controlsHint && !controlsHint.classList.contains('hidden')) {
        controlsHint.classList.add('hidden');
      }
    }, 5000);

    // Player position update function - delegates to PlayerController
    function updatePlayerPosition() {
      if (window.PlayerController && window.PlayerController.updatePlayerPosition) {
        window.PlayerController.updatePlayerPosition();
      } else {
        console.warn('PlayerController not available for position update');
      }
    }

    // Make this function globally available
    window.updatePlayerPosition = updatePlayerPosition;

  // Setup event handling through EventHandler module
  if (window.EventHandler) {
    window.EventHandler.setupEventListeners();
  } else {
    console.warn('EventHandler module not available - event handling may not work');
  }

  // Remove old cell-based movement function - replaced with smooth movement
  // function startContinuousMovement() { ... } - REMOVED
    
    // Event listeners setup moved to GameInitializer module
    if (window.GameInitializer) {
      window.GameInitializer.setupEventListeners();
    } else {
      console.warn('GameInitializer module not loaded for event listeners');
    }

    // =================================================================
    // GAME COORDINATION AND EVENT HANDLING
    // =================================================================
    // The following code coordinates the various modules and handles
    // browser events. Core game logic has been moved to modules.
    
    // Event handlers are now managed by EventHandler module
    
    // Resize handling moved to GameInitializer module
  </script>
</body>
</html>